<!-- Jeu clicker HTML : Bouchon Clicker ‚Äî Cr√©√© par GPT-5 Thinking -->
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bouchon Clicker</title>
<style>
  :root{
    --bg1:#0b132b; /* dark navy */
    --bg2:#1c2541; /* deep blue */
    --acc1:#0ff2a1; /* mint */
    --acc2:#4cc9f0; /* cyan */
    --gold:#f5c542; /* epic */
    --text:#ffffff;
    --muted:#c6c6d0;
    --danger:#ff6b6b;
    --shadow: 0 10px 25px rgba(0,0,0,.35);
    --radius:18px;
  }
  [data-theme="light"]{
    --bg1:#e8f4ff; --bg2:#f8fbff; --text:#0d1321; --muted:#4a5568;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--text);
    background: radial-gradient(1200px 800px at 20% -10%, rgba(76,201,240,.15), transparent 60%),
                radial-gradient(900px 700px at 120% 30%, rgba(15,242,161,.12), transparent 60%),
                linear-gradient(135deg, var(--bg1), var(--bg2));
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  }
  .wrap{max-width:1200px;margin:0 auto;padding:16px;display:grid;gap:16px;grid-template-columns:1.1fr .9fr}
  @media (max-width: 980px){.wrap{grid-template-columns:1fr}}

  /* Header */
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .title{display:flex;align-items:center;gap:12px}
  .logo{width:46px;height:46px;border-radius:14px;background:linear-gradient(145deg,var(--acc1),var(--acc2));display:grid;place-items:center;box-shadow:var(--shadow)}
  .logo span{font-weight:900;color:#0b132b;text-shadow:0 1px 0 rgba(255,255,255,.55)}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap}
  button, .pill{
    border:none; outline:none; cursor:pointer; color:var(--text);
    background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.15));
    border-radius: var(--radius);
    padding:10px 14px; box-shadow: var(--shadow);
    transition: transform .05s ease, filter .15s ease;
    user-select:none;
  }
  button:hover{filter:brightness(1.07)}
  button:active{transform:translateY(1px) scale(.99)}
  .pill{display:inline-flex;align-items:center;gap:8px}
  .pill input{accent-color:var(--acc1)}

  /* Panels */
  .card{background:rgba(255,255,255,.06);backdrop-filter: blur(6px); border:1px solid rgba(255,255,255,.08); border-radius: var(--radius); box-shadow:var(--shadow)}
  .stats{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;padding:12px}
  .stat{padding:10px 12px;background:rgba(0,0,0,.15);border-radius:12px}
  .stat .k{font-size:12px;color:var(--muted)}
  .stat .v{font-size:18px;font-weight:800}

  /* Main */
  .main{display:grid;grid-template-columns:1fr;gap:16px}
  .play{display:grid;grid-template-columns:1fr;place-items:center;padding:16px}
  #bigButton{
    width:min(360px, 90vw); height:min(360px, 90vw); border-radius:50%;
    background: radial-gradient(40% 40% at 30% 30%, rgba(255,255,255,.15), transparent 45%),
                linear-gradient(145deg, var(--acc2), var(--acc1));
    box-shadow: 0 18px 40px rgba(0,0,0,.5), inset 0 8px 18px rgba(255,255,255,.25);
    font-size: clamp(20px, 3.4vw, 26px); font-weight:900; color:#081018; text-shadow:0 2px 0 rgba(255,255,255,.55);
  }
  #bigButton small{display:block;font-weight:700;opacity:.65}

  /* Shop */
  .grid{display:grid;grid-template-columns:1fr;gap:10px}
  .shop{padding:14px;display:grid;grid-template-rows:auto 1fr auto;gap:10px;max-height:78vh}
  .shop h3{margin:0 0 4px 0}
  .shoplist{overflow:auto;padding-right:4px}
  .entry{display:flex;align-items:center;gap:10px;justify-content:space-between;padding:10px;border-radius:12px;background:rgba(0,0,0,.18);border:1px solid rgba(255,255,255,.06)}
  .entry .info{display:flex;flex-direction:column}
  .entry .name{font-weight:800}
  .entry .desc{font-size:12px;color:var(--muted)}
  .entry .price{font-weight:700}
  .entry .qty{font-size:12px;color:var(--muted)}
  .entry button{white-space:nowrap}
  .badge{font-size:11px;padding:3px 8px;border-radius:999px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2)}

  /* News */
  .news{padding:10px 12px;display:flex;align-items:center;justify-content:space-between;gap:10px}
  .news .text{min-height:22px}
  .news .epic{color:var(--gold);font-weight:900;letter-spacing:.3px;text-shadow:0 0 12px rgba(245,197,66,.6)}

  /* Floating gains */
  .float{position:fixed;pointer-events:none;left:0;top:0;transform:translate(-50%,-50%);font-weight:900;opacity:0;animation:floatUp .9s ease-out forwards}
  @keyframes floatUp{from{opacity:0;transform:translate(-50%,-10%) scale(.9)} 20%{opacity:1} to{opacity:0;transform:translate(-50%,-120%) scale(1.2)}}

  /* Toast */
  .toast{position:fixed;right:16px;bottom:16px;background:rgba(0,0,0,.7);padding:12px 14px;border-radius:12px;box-shadow:var(--shadow);border:1px solid rgba(255,255,255,.16);max-width:70vw}

  /* Modal */
  .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.55)}
  .modal .sheet{background:rgba(15,18,25,.95);border:1px solid rgba(255,255,255,.12);border-radius:18px;max-width:min(540px, 92vw);padding:18px;box-shadow:var(--shadow)}
  .modal h3{margin:0 0 8px 0}
  .actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;margin-top:12px}
  .gold-flash{position:fixed;inset:0;background:radial-gradient(800px 800px at 50% 50%, rgba(245,197,66,.22), transparent 60%);pointer-events:none;opacity:0;transition:opacity .6s ease}
  .gold-flash.show{opacity:1}

  a.link{color:var(--acc2);text-decoration:none;border-bottom:1px dashed rgba(255,255,255,.3)}
</style>
</head>
<body>
  <div class="gold-flash" id="goldFlash"></div>
  <div class="wrap">
    <header>
      <div class="title">
        <div class="logo"><span>üß¢</span></div>
        <div>
          <div style="font-weight:900;font-size:20px">Bouchon Clicker</div>
          <div style="opacity:.8;font-size:12px">Fabriquez des bouchons. Dominez le cosmos du li√®ge.</div>
        </div>
      </div>
      <div class="toolbar">
        <button id="btnPrestige" title="R√©initialiser pour gagner des jetons">‚ú® Prestige</button>
        <button id="btnReset" title="R√©initialiser compl√®tement la partie" style="background:linear-gradient(180deg, rgba(255,100,100,.25), rgba(120,0,0,.25));">üóëÔ∏è Reset</button>
        <label class="pill"><input type="checkbox" id="sfxToggle" checked> Sons</label>
        <label class="pill"><input type="checkbox" id="themeToggle"> Th√®me clair</label>
      </div>
    </header>

    <section class="card stats" id="statsBar">
      <div class="stat"><div class="k">Bouchons</div><div class="v" id="statTotal">0</div></div>
      <div class="stat"><div class="k">/ clic</div><div class="v" id="statCPC">1</div></div>
      <div class="stat"><div class="k">/ sec</div><div class="v" id="statCPS">0</div></div>
      <div class="stat"><div class="k">Produit au total</div><div class="v" id="statLifetime">0</div></div>
      <div class="stat"><div class="k">Multiplicateur</div><div class="v" id="statMult">x1.00</div></div>
    </section>

    <main class="main">
      <section class="card play">
        <button id="bigButton">
          <span>FABRIQUER DES BOUCHONS</span>
          <small>(clic = +<span id="btnCpc">1</span>)</small>
        </button>
      </section>
    </main>

    <aside class="card shop">
      <div>
        <h3>üõí Boutique</h3>
        <div style="font-size:12px;color:var(--muted)">Astuce : <b>Shift+clic</b> pour acheter √ó10</div>
      </div>
      <div class="shoplist" id="shopList"></div>
      <div class="news card">
        <div class="text" id="newsText"></div>
        <span class="badge" id="newsBadge">News</span>
      </div>
    </aside>
  </div>

  <!-- Toast container -->
  <div id="toast" class="toast" style="display:none"></div>

  <!-- Modal Prestige -->
  <div class="modal" id="modalPrestige">
    <div class="sheet">
      <h3>‚ú® Prestige (Recyclage de bouchons)</h3>
      <p>R√©initialisez votre progression pour obtenir des <b>Jetons de Prestige</b> qui augmentent votre production globale <b>+2% par jeton</b>.</p>
      <p id="prestigeInfo">Calcul en cours‚Ä¶</p>
      <div class="actions">
        <button id="confirmPrestige">Confirmer</button>
        <button id="cancelPrestige">Annuler</button>
      </div>
    </div>
  </div>

<script>
/* =========================
   Helpers (formatage, save)
========================= */
const fmt = (n)=>{
  if(!isFinite(n)) return '‚àû';
  if(n < 1000) return Math.floor(n).toString();
  const units = ['K','M','B','T','Qa','Qi','Sx','Sp','Oc','No','Dc'];
  let u = -1; let x = n;
  while(x >= 1000 && u < units.length-1){x/=1000;u++}
  return x.toFixed(x<10?2:x<100?1:0)+units[u];
};
const saveKey = 'bouchon-clicker-save-v1';
const saveGame = ()=>{
  state.lastSave = Date.now();
  try{ localStorage.setItem(saveKey, JSON.stringify(state)); }catch(e){ console.warn('Save failed', e); }
};
const loadGame = ()=>{
  try{
    const raw = localStorage.getItem(saveKey);
    if(!raw) return null;
    const data = JSON.parse(raw);
    return data;
  }catch(e){ console.warn('Load failed', e); return null; }
};
const clearGame = ()=>{ try{ localStorage.removeItem(saveKey);}catch{} };

/* =========================
   State (variables du jeu)
========================= */
const base = {
  click: 1,
  perSec: 0,
  mult: 1,
};
const state = {
  bouchons: 0,
  lifetime: 0,
  prestige: { tokens: 0 },
  upgrades: {}, // id -> qty
  lastTick: Date.now(),
  lastSave: Date.now(),
  sfx: true,
  theme: 'dark',
  achievements: {},
};

// D√©finition Boutique
const shop = [
  // Type 1: CPC
  {id:'cpc1', type:'cpc', name:'Doigt Agile', desc:'+1 / clic', base: 25, grow:1.15, effect:1},
  {id:'cpc2', type:'cpc', name:'Gant Turbo', desc:'+5 / clic', base: 200, grow:1.15, effect:5},
  {id:'cpc3', type:'cpc', name:'Marteau √† Bouchons', desc:'+25 / clic', base: 1200, grow:1.15, effect:25},
  // Type 2: CPS
  {id:'cps1', type:'cps', name:'Ouvrier', desc:'+1 / sec', base: 50, grow:1.15, effect:1},
  {id:'cps2', type:'cps', name:'Usine', desc:'+10 / sec', base: 500, grow:1.15, effect:10},
  {id:'cps3', type:'cps', name:'M√©ga-Usine', desc:'+100 / sec', base: 4500, grow:1.15, effect:100},
  // Type 3: Mult
  {id:'mul1', type:'mul', name:'Lubrifiant Magique', desc:'√ó1.20 global', base: 1500, grow:1.18, effect:1.20},
  {id:'mul2', type:'mul', name:'Hyperpub Galactique', desc:'√ó1.50 global', base: 12000, grow:1.22, effect:1.50},
];

// Succ√®s
const achievements = [
  {id:'click1', name:'Premier clic', test:()=>state.lifetime>=1},
  {id:'prod100', name:'100 bouchons', test:()=>state.lifetime>=100},
  {id:'prod1k', name:'1 000 bouchons', test:()=>state.lifetime>=1000},
  {id:'prod10k', name:'10 000 bouchons', test:()=>state.lifetime>=10000},
  {id:'buy10', name:'10 am√©liorations', test:()=>totalUpgrades()>=10},
  {id:'buy50', name:'50 am√©liorations', test:()=>totalUpgrades()>=50},
  {id:'speed1', name:'1 000 / sec', test:()=>getPerSec()>=1000},
  {id:'cpc100', name:'100 / clic', test:()=>getPerClick()>=100},
];

/* =========================
   Logic (click, buy, upgrade, save)
========================= */
function totalUpgrades(){
  return Object.values(state.upgrades).reduce((a,b)=>a+b,0);
}
function prestigeMultiplier(){
  return 1 + (state.prestige.tokens||0) * 0.02;
}
function getMult(){
  let m = prestigeMultiplier();
  for(const it of shop){ if(it.type==='mul'){ const q = state.upgrades[it.id]||0; if(q>0) m *= Math.pow(it.effect, q); } }
  return m;
}
function getPerClick(){
  let c = base.click;
  for(const it of shop){ if(it.type==='cpc'){ const q = state.upgrades[it.id]||0; c += it.effect*q; } }
  return c * getMult();
}
function getPerSec(){
  let s = base.perSec;
  for(const it of shop){ if(it.type==='cps'){ const q = state.upgrades[it.id]||0; s += it.effect*q; } }
  return s * getMult();
}
function priceOf(it, qty){
  const owned = state.upgrades[it.id]||0;
  // somme g√©om√©trique: base * grow^(owned..owned+qty-1)
  let total=0; let p = it.base * Math.pow(it.grow, owned);
  for(let i=0;i<qty;i++){ total+=p; p*=it.grow; }
  return Math.ceil(total);
}
function buy(it, qty){
  const cost = priceOf(it, qty);
  if(state.bouchons < cost) return false;
  state.bouchons -= cost;
  state.upgrades[it.id] = (state.upgrades[it.id]||0) + qty;
  ping('purchase');
  return true;
}
function tick(dt){ // dt en secondes
  const gain = getPerSec() * dt;
  state.bouchons += gain;
  state.lifetime += gain;
}

/* =========================
   Rendering (stats, boutique)
========================= */
const el = {
  total: document.getElementById('statTotal'),
  cpc: document.getElementById('statCPC'),
  cps: document.getElementById('statCPS'),
  life: document.getElementById('statLifetime'),
  mult: document.getElementById('statMult'),
  btnCpc: document.getElementById('btnCpc'),
  shopList: document.getElementById('shopList'),
  newsText: document.getElementById('newsText'),
  newsBadge: document.getElementById('newsBadge'),
  goldFlash: document.getElementById('goldFlash'),
  toast: document.getElementById('toast'),
};

function renderStats(){
  el.total.textContent = fmt(state.bouchons);
  el.cpc.textContent = fmt(getPerClick());
  el.cps.textContent = fmt(getPerSec());
  el.life.textContent = fmt(state.lifetime);
  el.mult.textContent = 'x'+getMult().toFixed(2);
  el.btnCpc.textContent = fmt(getPerClick());
}

function renderShop(){
  el.shopList.innerHTML = '';
  for(const it of shop){
    const qty = state.upgrades[it.id]||0;
    const price1 = priceOf(it,1);
    const affordable = state.bouchons >= price1;
    const row = document.createElement('div'); row.className='entry';
    row.innerHTML = `
      <div class="info">
        <span class="name">${it.name} <span class="qty">(x${qty})</span></span>
        <span class="desc">${it.desc} ‚Ä¢ <span class="price">Prix: ${fmt(price1)}</span></span>
      </div>
      <div style="display:flex;gap:6px">
        <button data-id="${it.id}" data-q="1" ${affordable?'':'disabled'}>Acheter</button>
        <button data-id="${it.id}" data-q="10" ${state.bouchons>=priceOf(it,10)?'':'disabled'}>√ó10</button>
      </div>`;
    el.shopList.appendChild(row);
  }
}

/* =========================
   UI (animations, news)
========================= */
function floatAt(x,y,text,color){
  const d = document.createElement('div'); d.className='float'; d.textContent = text; d.style.left=x+'px'; d.style.top=y+'px'; if(color) d.style.color=color;
  document.body.appendChild(d); setTimeout(()=>d.remove(), 900);
}
function toast(msg){
  el.toast.textContent = msg; el.toast.style.display='block';
  setTimeout(()=>{ el.toast.style.display='none'; }, 2300);
}

const funnyNews = [
  "Le stagiaire a encore renvers√© des bouchons.",
  "Un clic parfait a invoqu√© un arc-en-ciel !",
  "Les usines chantent votre gloire.",
  "Votre entrep√¥t a besoin d‚Äôun plus grand entrep√¥t.",
  "Un bouchon sauvage appara√Æt. Vous l‚Äôattrapez.",
  "Le march√© du li√®ge explose (de rire).",
  "On a retrouv√© un bouchon de 1789 : vintage !",
  "Votre doigt demande une augmentation.",
  "Record battu : 123 clics en une minute (selon vous).",
  "Vos bouchons sont d√©sormais neutres en carbone (promis).",
  "Le chef d‚Äôusine a fait un burn-out‚Ä¶ de bonheur.",
  "Un bouchon g√©ant √©crase un concurrent !",
  "Les ouvriers demandent des vacances sur Mars.",
  "Un pigeon a vol√© un bouchon. Il est d√©sormais PDG.",
  "Vous r√™vez de bouchons la nuit. C‚Äôest normal.",
  "Un clic si fort qu‚Äôil a d√©clench√© une coupure d‚Äô√©lectricit√©.",
  "Le ministre du Li√®ge salue vos efforts.",
  "Une pluie de bouchons s‚Äôabat sur la ville.",
  "Votre usine est visible depuis l‚Äôespace.",
  "Une l√©gende dit que vous ne dormez plus.",
  "Votre souris chauffe √† 300¬∞C.",
  "Les investisseurs applaudissent votre doigt√©.",
  "Un ouvrier pr√©tend avoir vu un bouchon parler.",
  "Le grand conseil du li√®ge vous f√©licite.",
  "Vos rivaux ferment boutique, impuissants.",
  "Un bouchon se prend pour une √©toile filante.",
  "Un clic a r√©sonn√© jusqu‚Äôau Japon.",
  "Les bouchons envahissent les oc√©ans‚Ä¶ positivement !",
  "Un nouveau brevet : bouchons biod√©gradables √† 102%.",
  "Votre usine tourne plus vite que la Terre.",
  "Les statistiques s‚Äôaffolent, litt√©ralement.",
  "Vous recevez le prix Nobel du Clic.",
  "Une IA a tent√© de vous imiter. Elle a crash√©.",
  "Les bouchons sont d√©sormais monnaie officielle.",
  "Un employ√© a cliqu√© par erreur. Il est promu.",
  "Une souris sans fil ? Pas chez vous.",
  "Des aliens observent votre productivit√©.",
  "Les bouchons s‚Äôauto-produisent par admiration.",
  "Une bouteille a suppli√© pour √™tre bouch√©e par vous.",
  "Votre caf√© contient d√©sormais du li√®ge.",
  "Une star hollywoodienne porte un collier de vos bouchons.",
  "Vos usines battent le rythme du monde.",
  "Un clic, un destin.",
  "Les bouchons ont leur propre syndicat.",
  "Le PDG de la concurrence pleure doucement.",
  "Une statue de vous est inaugur√©e en Li√®gistan.",
  "Les bouchons vous acclament depuis les caisses.",
  "Les chats du bureau marchent sur le clavier. Productivit√© +3%.",
  "Un drone a √©t√© bouchonn√© par accident.",
  "Votre doigt a officiellement battu un record mondial.",
  "Des chercheurs √©tudient votre efficacit√© au clic.",
  "Une temp√™te de li√®ge s‚Äôabat sur la plan√®te.",
  "Les bouchons entrent au patrimoine immat√©riel de l‚ÄôUNESCO.",
  "Un fant√¥me de bouchon hante votre usine.",
  "Un clic a ouvert un portail vers le multivers du li√®ge.",
  "Les bouchons vous √©lisent empereur.",
  "Un bouchon en or a √©t√© aper√ßu. Introuvable depuis.",
  "Vos employ√©s chantent l‚Äôhymne du li√®ge.",
  "Un nouveau slogan : ‚ÄúCliquez responsable.‚Äù",
  "Les robots de l‚Äôusine demandent un jour f√©ri√©.",
  "Une √©clipse de bouchons √©blouit la plan√®te.",
  "Le ciel sent le li√®ge. Bravo.",
  "Les ventes de souris explosent dans le monde.",
  "Le dieu du clic vous observe avec respect.",
  "Des arch√©ologues trouvent un bouchon sign√© de vous.",
  "Une nouvelle √®re commence : l‚Äô√Çge du Bouchon.",
  "Les journaux titrent : ‚ÄúUn clic pour les gouverner tous.‚Äù",
  "Une l√©gende parle d‚Äôun super-clic mythique.",
  "Votre entreprise vaut d√©sormais 3 galaxies.",
  "Une bouteille a pleur√© de joie en vous voyant.",
  "Les march√©s financiers se convertissent en bouchons.",
  "Une pluie de bonus s‚Äôannonce.",
  "Vos bouchons sont utilis√©s par la NASA.",
  "Une arm√©e de mini-bouchons se forme spontan√©ment.",
  "Un clic a d√©clench√© une onde de choc cosmique.",
  "Les singes ont appris √† cliquer gr√¢ce √† vous.",
  "Un bouchon philosophe √©crit ses m√©moires.",
  "Votre souris s‚Äôest transform√©e en artefact l√©gendaire.",
  "Les bouchons font gr√®ve‚Ä¶ de satisfaction.",
  "Les m√©dias vous appellent ‚ÄúLe Roi du Li√®ge.‚Äù",
  "Un concours mondial de clics est annul√© (trop in√©gal).",
  "Une bouteille g√©ante se forme dans le ciel.",
  "Le serveur de sauvegarde implore votre cl√©mence.",
  "Vos doigts sont assur√©s pour 1 million d‚Äôeuros.",
  "Les bouchons r√™vent d‚Äô√™tre comme vous.",
  "Des enfants collectionnent vos bouchons comme des tr√©sors.",
  "Une pluie de li√®ge b√©nit votre empire.",
  "Les bouchons se multiplient par osmose.",
  "Une rumeur dit que vous cliquez avec les coudes.",
  "Votre clic a √©t√© entendu √† l‚ÄôONU.",
  "Une secte du clic se forme secr√®tement.",
  "Votre usine √©met une lueur divine.",
  "Un message mystique : ‚ÄúContinue de cliquer.‚Äù",
  "Un chat a pris le contr√¥le de la production.",
  "Les bouchons dansent √† la pleine lune.",
  "Vous sentez l‚Äôodeur du succ√®s‚Ä¶ et du li√®ge.",
  "Votre √©cran tremble sous la puissance du clic.",
  "Des journalistes campent devant votre usine.",
  "Le sol est recouvert de bouchons. Magnifique.",
  "Une √©toile a √©t√© nomm√©e ‚ÄúBouchon-42.‚Äù",
  "Votre productivit√© fait fondre les serveurs.",
  "Les souris m√©caniques se prosternent devant vous.",
  "Une temp√™te de clics approche.",
  "Des ing√©nieurs vous demandent votre secret.",
  "Le syndicat des doigts vous f√©licite.",
  "Une distorsion temporelle double la production !",
  "Un bouchon √©crit une biographie de vous.",
  "Votre chaise devient un tr√¥ne.",
  "Les bouteilles ne ferment plus sans votre b√©n√©diction.",
  "Un vortex de bouchons s‚Äôouvre sous l‚Äôusine.",
  "Le pr√©sident vous appelle ‚ÄúMa√Ætre du Clic.‚Äù",
  "Votre doigt m√©rite une m√©daille d‚Äôor.",
  "Une l√©gende raconte que vous cliquez plus vite que la lumi√®re.",
  "Un stagiaire a confondu le li√®ge avec du fromage.",
  "Un clic, deux clics, le monde tremble.",
  "Un bouchon vous regarde avec admiration.",
  "Les serveurs crient ‚Äúpiti√©‚Äù sous vos clics.",
  "Un vortex temporel multiplie vos bouchons.",
  "Un clic sur mille fait un v≈ìu.",
  "Le stock atteint le plafond. Vous l‚Äôagrandissez.",
  "Une pluie de champagne pour f√™ter vos records.",
  "Les bouchons parlent de vous √† la machine √† caf√©.",
  "Des √©toiles tombent dans vos entrep√¥ts.",
  "Une proph√©tie annonce votre ascension au Panth√©on du Li√®ge.",
  "Un clic trop fort a fait trembler Internet.",
  "Votre souris est d√©clar√©e ‚Äúarme de production massive.‚Äù",
  "Une chanson intitul√©e ‚ÄúLe roi du bouchon‚Äù devient virale.",
  "Un oiseau utilise un bouchon comme chapeau.",
  "Le maire renomme la rue en ‚ÄúAll√©e du Li√®ge.‚Äù",
  "Les bouteilles se battent pour √™tre bouch√©es par vous.",
  "Une pluie de likes s‚Äôabat sur votre profil.",
  "Un enfant dit vouloir √™tre ‚Äúbouchonneur‚Äù plus tard.",
  "Les bouchons se reproduisent sans autorisation.",
  "Une IA tente d‚Äôimiter vos clics. Elle √©choue lamentablement.",
  "Le temps ralentit √† chaque clic. √âtrange.",
  "Un bouchon devient influenceur sur les r√©seaux.",
  "Votre nom devient une unit√© de mesure de clics.",
  "Les dieux du li√®ge sourient en silence.",
  "Les scientifiques cr√©ent une particule ‚Äúclicon.‚Äù",
  "Une pub dit : ‚ÄúUn clic pour les unir tous.‚Äù",
  "Votre souris vous supplie de ralentir.",
  "Les bouteilles vides chantent votre hymne.",
  "Une explosion de li√®ge visible depuis l‚Äôorbite.",
  "Le sol vibre de bonheur sous vos clics.",
  "Un agent secret enqu√™te sur vos performances.",
  "Une nouvelle religion : le Clicisme.",
  "Votre souris devient consciente.",
  "Les bouchons font la f√™te sans vous attendre.",
  "Une l√©gende dit qu‚Äôun double-clic invoque la chance.",
  "Une arm√©e de bouchons en plastique s‚Äôincline devant vous.",
  "Votre empire du li√®ge entre dans les livres d‚Äôhistoire.",
  "Un clic, une √©tincelle, une r√©volution.",
  "Le monde entier vous appelle ‚ÄúGrand Bouchonneur.‚Äù",
  "Votre bureau ressemble √† une cave √† vin cosmique.",
  "Les bouchons fusionnent en super-bouchon.",
  "Un ing√©nieur propose un clic automatique. Vous refusez par honneur.",
  "Une temp√™te magn√©tique multiplie vos gains.",
  "Les ouvriers sculptent votre visage dans le li√®ge.",
  "Un hologramme de bouchon appara√Æt. Il dit bonjour.",
  "Une souris mythique na√Æt dans votre usine.",
  "Des applaudissements retentissent √† chaque clic.",
  "Le li√®ge devient mati√®re premi√®re interstellaire.",
  "Vous entrez dans la l√©gende du clic √©ternel.",
];


const epicNews = [
  'üåü L√âGENDAIRE ! Vous venez d\'obtenir un objet mythique !',
  '‚ú® PRODIGE ! Les bouchons pleuvent du ciel !',
  'üëë ROYAL ! Vous r√©gnez sur l\'Empire du Li√®ge !',
];
let newsIndex = 0; let newsTimer = 0;
function rollNews(){
  // Chance √©pique 1/12
  if(Math.random()<1/12){
    el.newsText.innerHTML = `<span class="epic">${epicNews[Math.floor(Math.random()*epicNews.length)]}</span>`;
    el.newsBadge.textContent='√âPIQUE';
    el.newsBadge.style.color='var(--gold)';
    el.goldFlash.classList.add('show');
    setTimeout(()=>el.goldFlash.classList.remove('show'), 650);
  }else{
    el.newsText.textContent = funnyNews[newsIndex % funnyNews.length];
    el.newsBadge.textContent='News'; el.newsBadge.style.color='';
    newsIndex++;
  }
}

/* =========================
   Achievements
========================= */
function checkAchievements(){
  for(const a of achievements){
    if(!state.achievements[a.id] && a.test()){
      state.achievements[a.id] = true;
      floatAt(window.innerWidth-120, 70+Object.keys(state.achievements).length*2, `Succ√®s: ${a.name}`);
      toast(`üéñÔ∏è Succ√®s d√©bloqu√© : ${a.name}`);
    }
  }
}

/* =========================
   SFX (WebAudio)
========================= */
let audioCtx=null;
function ensureAudio(){ if(!audioCtx){ try{ audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }catch{} } }
function beep(freq=520, dur=0.04, vol=0.08){ if(!state.sfx) return; ensureAudio(); if(!audioCtx) return; const t=audioCtx.currentTime; const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type='triangle'; o.frequency.setValueAtTime(freq,t); g.gain.setValueAtTime(vol,t); g.gain.exponentialRampToValueAtTime(0.0001, t+dur); o.connect(g).connect(audioCtx.destination); o.start(t); o.stop(t+dur); }
function ping(type){ if(type==='purchase') beep(640, .07, .12); else beep(520,.04,.08); }

/* =========================
   Prestige
========================= */
const modalPrestige = document.getElementById('modalPrestige');
const prestigeInfo = document.getElementById('prestigeInfo');
function calcPrestigeGains(){
  // Formule simple : floor( sqrt(lifetime/1500) )
  return Math.floor(Math.sqrt(state.lifetime/1500));
}
function openPrestige(){
  const gain = calcPrestigeGains();
  const mult = (1 + (state.prestige.tokens + gain)*0.02).toFixed(2);
  prestigeInfo.innerHTML = `Vous gagnerez <b>${gain}</b> jeton(s). Votre multiplicateur passera √† <b>x${mult}</b>.`;
  modalPrestige.style.display='grid';
}
function doPrestige(){
  const gain = calcPrestigeGains();
  if(gain<=0){ toast('Pas assez de production totale pour du prestige.'); return; }
  state.prestige.tokens += gain;
  // Reset soft
  state.bouchons = 0; state.upgrades={};
  // On garde lifetime pour l\'historique
  saveGame();
  modalPrestige.style.display='none';
  toast(`‚ú® Prestige ! +${gain} jeton(s)`);
}

/* =========================
   Init (chargement, boucle)
========================= */
const bigButton = document.getElementById('bigButton');
const sfxToggle = document.getElementById('sfxToggle');
const themeToggle = document.getElementById('themeToggle');
const btnPrestige = document.getElementById('btnPrestige');
const btnReset = document.getElementById('btnReset');
const confirmPrestige = document.getElementById('confirmPrestige');
const cancelPrestige = document.getElementById('cancelPrestige');

// Charger sauvegarde
(function(){
  const data = loadGame();
  if(data){
    Object.assign(state, data);
    // bonus offline
    const now = Date.now();
    const elapsed = Math.max(0, (now - (data.lastSave||now)) / 1000);
    if(elapsed>5){
      const off = getPerSec() * Math.min(elapsed, 3600*8); // cap 8h
      state.bouchons += off; state.lifetime += off;
      toast(`+${fmt(off)} bouchons gagn√©s hors-ligne (${Math.floor(elapsed)}s)`);
    }
    document.documentElement.setAttribute('data-theme', state.theme==='light'?'light':'dark');
    themeToggle.checked = state.theme==='light';
    sfxToggle.checked = !!state.sfx;
  }
  renderStats();
  renderShop();
  rollNews();
})();

// Interactions
bigButton.addEventListener('click', (e)=>{
  const add = getPerClick();
  state.bouchons += add; state.lifetime += add;
  const r = bigButton.getBoundingClientRect();
  const x = r.left + r.width/2 + (Math.random()*40-20);
  const y = r.top + r.height/2 + (Math.random()*20-10);
  floatAt(x,y,'+'+fmt(add));
  ping('click');
  checkAchievements();
  renderStats(); renderShop();
});

el.shopList.addEventListener('click', (e)=>{
  const b = e.target.closest('button[data-id]'); if(!b) return;
  const id = b.getAttribute('data-id'); const q = parseInt(b.getAttribute('data-q'))||1;
  const it = shop.find(s=>s.id===id); if(!it) return;
  const qty = (e.shiftKey?10:q);
  if(buy(it, qty)){
    checkAchievements();
    renderStats(); renderShop();
  }else{ toast('Pas assez de bouchons !'); beep(220,.05,.06); }
});

// Toolbar
sfxToggle.addEventListener('change', ()=>{ state.sfx = sfxToggle.checked; if(state.sfx) beep(); saveGame(); });
themeToggle.addEventListener('change', ()=>{ state.theme = themeToggle.checked?'light':'dark'; document.documentElement.setAttribute('data-theme', themeToggle.checked?'light':'dark'); saveGame(); });
btnReset.addEventListener('click', ()=>{
  if(confirm('R√©initialiser TOUTE la partie ? (prestige inclus)')){ clearGame(); location.reload(); }
});
btnPrestige.addEventListener('click', openPrestige);
confirmPrestige.addEventListener('click', doPrestige);
cancelPrestige.addEventListener('click', ()=> modalPrestige.style.display='none');

// Boucle principale
let acc=0; let last=performance.now();
function loop(t){
  const dt = (t-last)/1000; last=t; acc+=dt;
  // Physique fixe 20Hz pour stabilit√©
  while(acc>0.05){ tick(0.05); acc-=0.05; }
  // UI ~60fps
  renderStats();
  // Auto-save toutes les 10s
  if(Date.now() - state.lastSave > 10000) saveGame();
  // News toutes les 7s
  newsTimer += dt; if(newsTimer>7){ newsTimer=0; rollNews(); }
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

// Easter egg: Konami => +1% multiplicateur temporaire 60s
(function(){
  const code = ['ArrowUp','ArrowUp','ArrowDown','ArrowDown','ArrowLeft','ArrowRight','ArrowLeft','ArrowRight','b','a'];
  let idx=0; let bonus=0; let until=0;
  window.addEventListener('keydown', (e)=>{
    if(e.key===code[idx]){ idx++; if(idx===code.length){ idx=0; bonus+=0.01; until=Date.now()+60000; toast('üîÆ Bonus secret: +1% production pour 60s'); beep(880,.07,.12);} }
    else idx=0;
  });
  // int√©grer bonus dans getMult via patch l√©ger
  const _getMult = getMult; window.getMult = function(){
    let m = _getMult();
    if(until>Date.now()) m *= (1+bonus);
    return m;
  }
})();

// R√©activit√©: MAJ affichage au blur/focus
window.addEventListener('focus', ()=>{ renderStats(); renderShop(); });

// Auto-√©quilibrage l√©ger du d√©but: donner 10 bouchons si le joueur stagne 20s sans achat et <50 bouchons
(function(){ let lastBuyCount=0; setInterval(()=>{
  if(totalUpgrades()===lastBuyCount && state.bouchons<50){ state.bouchons+=10; toast('+10 pour vous lancer !'); }
  lastBuyCount=totalUpgrades();
}, 20000); })();

</script>
</body>
</html>
